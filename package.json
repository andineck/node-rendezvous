{
  "name": "node-rendezvous",
  "version": "0.1.0",
  "description": "Straight-forward rendezvous for 'local servers' behind NATs and 'mobile clients' using a 'cloud' server.",
  "author": {
    "name": "Marshall Rose",
    "email": "mrose17@gmail.com"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/mrose17/node-rendezvous.git"
  },
  "bugs": {
    "url": "https://github.com/mrose17/node-rendezvous/issues"
  },
  "keywords": [
    "nat",
    "cloud",
    "rendezvous"
  ],
  "engines": {
    "node": ">=0.10"
  },
  "dependencies": {
    "MD5": "1.0.3",
    "nedis": "0.1.0",
    "portfinder": "0.2.1",
    "redis": "0.8.x",
    "speakeasy": "git://github.com/mrose17/speakeasy.git",
    "winston": "0.7.x",
    "x509-keygen": "git://github.com/mrose17/x509-keygen.git"
  },
  "readmeFilename": "README.md",
  "readme": "node-rendezvous\n===============\nStraight-forward rendezvous for 'hidden servers' (behind firewalls/NATs) and 'mobile clients' using a third-party service.\n\nThis package implements an HTTP-specific protocol that will allow an HTTP connection from the mobile client to the hidden\nserver.\n\nThe hidden server uses HTTPS and the CONNECT method both to authenticate itself and wait for a rendezvous.\nThe mobile client establishes an HTTPS connection to the rendezvous server,\nand specifies the identity of the hidden server.\nAt this point the rendezvous server moves the octets back-and-forth.\n\nThe protocol may be provisioned using a [PAAS](http://en.wikipedia.org/wiki/Platform_as_a_service) provider,\n_if_ that service transparently supports the HTTP CONNECT method.\nOtherwise, deployment must be provisioned using a [VPS](http://en.wikipedia.org/wiki/Virtual_private_server).\n\n    ATTN PAAS providers: if your service transparently supports the HTTP\n    connect method, please contact the repository maintainer! I would very\n    much like to use your service as a paying customer...\n\n_Note that I haven't found a PAAS provider that supports CONNECT, so i'm using a VPS instead._\n\n## Protocol specification\n\nThe protocol:\n\n1. The rendezvous server resides at a well-known location in the Internet, e.g.,\n\n        https://rendezvous.example.com/\n\n2. The hidden server establishes an HTTPS connection to the rendezvous server,\nand authenticates using the CONNECT method, e.g.,\n\n        CONNECT uuid:ID?response=TKN HTTP/1.1\n\n    where 'ID' is administratively assigned by the provider of the rendezvous server,\nand TKN is a one-time authentication token.\n\n3. If the hidden server successfully authenticates itself,\nthen the rendezvous server sends:\n\n        HTTP/1.1 200 OK\n\n    and waits for an (eventual) rendezvous with the mobile client.\n(If an error occurs, the rendezvous server returns a 4xx or 5xx response and closes the connection.)\n\n    Similarly,\nthe hidden server, upon receiving the 200 response,\nwaits for a subsequent HTTP request from the mobile client over the connection.\nIn the interim,\nif the connection fails,\nthe hidden server retries accordingly.\n\n4. The mobile client establishes an HTTPS connection to the rendezvous server, e.g.,\n\n        https://rendezvous.example.com/...\n\n    and gets back a request for digest authentication from the rendezvous server:\n\n        HTTP/1.1 401\n        WWW-Authenticate: Digest realm=\"rendezvous\"\n                          , qop=\"auth, auth-int\"\n                          , nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\"\n                          , opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"\n\n    and the mobile client responds using the hidden server's UUID as the username with any password:\n\n        GET /... HTTP/1.1\n        Host: ...\n        Connection: keep-alive\n        Authorization: Digest username=\"ID\"\n                       , realm=\"rendezvous\"\n                       , qop=auth\n                       , nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\"\n                       , opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"\n                       , ...\n\n    (Yes, the HTTP-specific protocol misuses HTTP's\n[digest authentication](http://en.wikipedia.org/wiki/Digest_authentication) header to identify the hidden server.)\n\n5. If a hidden server with that identity is registered,\nthen the rendezvous server sends the mobile client's second HTTP request over the connection to the hidden server,\nbut without the 'Authentication' header.\n(Otherwise, the rendezvous server returns a 4xx or 5xx response and closes the connection.)\n\n6. Upon receiving the HTTP request,\nin addition to processing any data on the connection,\nthe hidden server may make another HTTPS connection to the rendezvous server.\n(In this fashion,\nthe hidden server should always have something waiting for the next mobile client connection.)\n\n7. Regardless:\n\n * any data written from one socket is written to the other; and,\n\n * if either socket is closed, the other socket is also closed.\n\nPictorially:\n\n                                rendezvous  server\n                                +----------------+\n                                |                |\n                                | 1:listen on    |\n                                | well-known IP  |\n                                | adddress and   |\n     \"hidden\" server            | TCP port       |\n     behind NAT, etc.           |                |\n    +----------------+          |                |\n    |                |          |                |\n    |2:HTTPS CONNECT |   ---->  |                |\n    |                |          |                |\n    |                |  <----   | 3:return 200   |\n    |                |          |                |\n    |  keep TCP open |          | keep TCP open  |            mobile  client\n    |                |          |                |          +----------------+\n    |                |          |                |          |                |\n    |                |          |                |          | 4:HTTPS with   |\n    |                |          |                |  <----   |                |\n    |                |          |                |          |                |\n    |                |          | return 401     |   ---->  |                |\n    |                |          |                |          |                |\n    |                |          |                |          | HTTPS with     |\n    |                |          |                |          | digest         |\n    |                |          |                |  <----   | authentication |\n    |                |          |                |          |                |\n    |                |  <----   | 5:send request |          |                |\n    |                |          |                |          |                |\n    |                |          |                |          |                |\n    | 6:             |          |                |          |                |\n    | [if multiple   |          |                |          |                |\n    |  connections   |          |                |          |                |\n    |  are desired,  |          |                |          |                |\n    |  another TCP   |          |                |          |                |\n    |  connection to |          |                |          |                |\n    |  the rendezvous|          |                |          |                |\n    |  server occurs]|          |                |          |                |\n    |                |          |                |          |                |\n    |                |          |                |          |                |\n    |       7:       |          |       7:       |          |       7:       |\n    | send/recv data |  <---->  | <------------> |  <---->  | send/recv data |\n    |    until close |          |                |          | until close    |\n    |                |          |                |          |                |\n    |                |  <----   | <------------  |  <----   | close          |\n    |                |          |     and/or     |          |                |\n    |          close |   ---->  |  ------------> |   ---->  |                |\n    |                |          |                |          |                |\n    +----------------+          +----------------+          +----------------+\n\nSecurity Model\n==============\nThe security model is:\n\n1. The hidden server and the mobile client have to know the domain-name or IP-address of the rendezvous server,\nand have to trust the certificate used by the rendezvous server.\nThis knowledge and trust is determined by out-of-band means.\n\n2. The hidden server and rendezvous server must share a time-based secret.\nThis is how the rendezvous server knows that the hidden server is allowed to respond to requests for a particular UUID.\nThis shared secret is created by out-of-band means.\n\n3. The mobile client does not need to authenticate itself to the rendezvous server.\nIf a hidden server is responding for a particular UUID,\nthen amy mobile client knowing the UUID is allowed to initiate a connection to that hidden server.\n\n4. __Most importantly:__ it is the responsibility of the hidden server to authenticate the mobile client once the rendezvous\noccurs.\nAlthough there are many well-reasoned arguments as to why hiding behind a firewall is a bad thing,\nplease do not negate the one good thing about being behind a firewall or NAT!\n\nVPS Set-Up\n==========\nYou do not need to have a domain name for your VPS;\nhowever, you must have a stable IP address (e.g., 'a.b.c.d').\n\n1. Get a [tarball](https://github.com/mrose17/node-rendezvous/archive/master.zip) of this repostory onto your local system,\nextract it, and then:\n\n        % cd node-rendezvous-master\n        % npm -l install\n\n    Note that until we reach Step 7, all the commands will be run on your local system.\n\n2. Create a file called:\n\n        vps.js\n\n    that looks like this:\n\n        var fs          = require('fs')\n          ;\n\n        exports.options =\n          { rendezvousHost : 'a.b.c.d'\n          , rendezvousPort : 8899\n        \n          , keyData        : fs.readFileSync('./registrar.key')\n          , crtData        : fs.readFileSync('./registrar.crt')\n        \n          , redisHost      : '127.0.0.1'\n          , redisPort      : 6379\n          , redisAuth      : ''\n          };\n    \n3. Create a keypair for use by the rendezvous server:\n\n        % node make-cert.js\n\n        % chmod  a-w registrar.key registrar.crt\n\n        % chmod go-r registrar.key\n\n    to create a self-signed certificate:\n\n        registrar.crt\n\n    and the corresponding private key:\n\n        registrar.key\n\n4. We're nearly ready.\nThe next step is to create entries in the database for the hidden servers.\nRunning:\n\n        % node users.js\n\n    will bring up a server on:\n\n        http://127.0.0.1:8893\n\n    Browse this URL, and you will see all UUIDs defined in the database (initially, none).\nTo create an entry, use the form on the page.\nWhenever an entry is created,\na JS file is created which you can use with your hidden server.\nYou will want to copy the JS file to the provisioning area for your hidden server.\n\n5. When you are done creating entries for the remote servers, kill the node process running\n\n        users.js\n\n6. Copy the server files to the VPS:\n\n        % rm -rf node_modules\n        % cd .. ; scp -r node-rendezvous-master root@a.b.c.d:.\n\n7. Login to the VPS and install [node.js](http://nodejs.org/download/), and then\n\n        vps% cd node-rendezvous-master/\n        vps% npm install -l\n        vps% cp vps.js local.js\n\n8. Finally, start the server:\n\n        vps% bin/run.sh\n\n    Log entries are written to the file:\n\n        server.log\n\nLicense\n=======\n\n[MIT](http://en.wikipedia.org/wiki/MIT_License) license. Freely have you received, freely give.\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the 'Software'), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n",
  "homepage": "https://github.com/mrose17/node-rendezvous",
  "_id": "node-rendezvous@0.1.0",
  "dist": {
    "shasum": "08f4201a6dd51dd5dbf5b2068f1c1dc5087a96b5"
  },
  "_from": "node-rendezvous@",
  "_resolved": "https://registry.npmjs.org/node-rendezvous/-/node-rendezvous-0.1.0.tgz"
}
